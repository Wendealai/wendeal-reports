# Context7æœ€ä½³å®è·µï¼šNetlifyéƒ¨ç½²ä¿®å¤æ€»ç»“

## ğŸ”§ ä¸»è¦ä¿®å¤å†…å®¹

### 1. Next.jsé…ç½®ä¿®å¤ (`next.config.js`)
- **ç§»é™¤exportæ¨¡å¼**ï¼šä¸å†ä½¿ç”¨`output: 'export'`ï¼Œæ”¹ç”¨Netlifyå‡½æ•°å¤„ç†API
- **ä¿®å¤æ•°æ®åº“è·¯å¾„**ï¼šæœ¬åœ°å¼€å‘ä½¿ç”¨`./prisma/dev.db`ï¼ŒNetlifyä½¿ç”¨`/tmp/dev.db`
- **æ·»åŠ å®‰å…¨headers**ï¼šå®ç°XSSå’Œiframeä¿æŠ¤
- **Webpackä¼˜åŒ–**ï¼šæ­£ç¡®å¤„ç†Prismaå®¢æˆ·ç«¯å¤–éƒ¨åŒ–

### 2. Netlifyé…ç½®ä¿®å¤ (`netlify.toml`)
- **å…·ä½“åŒ–é‡å®šå‘è§„åˆ™**ï¼š
  - `/api/auth/*` â†’ `/.netlify/functions/auth-login`
  - `/api/categories/*` â†’ `/.netlify/functions/categories`
  - `/api/reports/*` â†’ `/.netlify/functions/reports`
  - `/api/init/*` â†’ `/.netlify/functions/init-db`
- **å‡½æ•°ä¼˜åŒ–**ï¼šæ·»åŠ è¶…æ—¶é…ç½®å’Œå¤–éƒ¨æ¨¡å—å¤„ç†
- **ç§»é™¤æ„å»ºæ—¶æ•°æ®åº“æ“ä½œ**ï¼šæ„å»ºæ—¶ä¸å†æ‰§è¡Œ`db:push`å’Œ`db:seed`

### 3. Prismaé…ç½®ä¼˜åŒ– (`src/lib/prisma.ts`)
- **ç®€åŒ–æ—¥å¿—é…ç½®**ï¼šç”Ÿäº§ç¯å¢ƒåªè®°å½•é”™è¯¯ï¼Œå¼€å‘ç¯å¢ƒè®°å½•é”™è¯¯å’Œè­¦å‘Š
- **å…¨å±€å®ä¾‹ç®¡ç†**ï¼šæ— æœåŠ¡å™¨ç¯å¢ƒä¸­çš„æ­£ç¡®å®ä¾‹å¤ç”¨
- **è‡ªåŠ¨åˆå§‹åŒ–æ£€æŸ¥**ï¼šè¿è¡Œæ—¶æ£€æŸ¥å¹¶åˆ›å»ºé»˜è®¤ç”¨æˆ·å’Œåˆ†ç±»
- **ç¯å¢ƒé€‚åº”**ï¼šæ ¹æ®è¿è¡Œç¯å¢ƒè‡ªåŠ¨é€‰æ‹©æ•°æ®åº“è·¯å¾„

### 4. å‡½æ•°ä¼˜åŒ– (`netlify/functions/`)
- **ç»Ÿä¸€å®ä¾‹ç®¡ç†**ï¼šæ‰€æœ‰å‡½æ•°ä½¿ç”¨ç›¸åŒçš„Prismaå®¢æˆ·ç«¯åˆ›å»ºæ¨¡å¼
- **è‡ªåŠ¨åˆå§‹åŒ–**ï¼šAPIè°ƒç”¨æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶åˆå§‹åŒ–æ•°æ®åº“
- **å¢å¼ºé”™è¯¯å¤„ç†**ï¼šè¯¦ç»†çš„é”™è¯¯åˆ†ç±»å’Œç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- **CORSæ”¯æŒ**ï¼šæ­£ç¡®å¤„ç†è·¨åŸŸè¯·æ±‚

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šç¯å¢ƒå˜é‡é…ç½®
åœ¨Netlify Dashboard â†’ Site settings â†’ Environment variables ä¸­æ·»åŠ ï¼š

```bash
# å¿…éœ€é…ç½®
DATABASE_URL="file:/tmp/dev.db?connection_limit=1&pool_timeout=10"
JWT_SECRET="[ç”Ÿæˆ32å­—ç¬¦éšæœºå¯†é’¥]"
NEXTAUTH_SECRET="[ç”Ÿæˆ32å­—ç¬¦éšæœºå¯†é’¥]"
NEXTAUTH_URL="https://your-site-name.netlify.app"
DEFAULT_USER_ID="cmbusc9x00000x2w0fqyu591k"
```

### æ­¥éª¤2ï¼šå¯†é’¥ç”Ÿæˆ
è¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆå®‰å…¨å¯†é’¥ï¼š

```bash
# JWT_SECRET
node -e "console.log('JWT_SECRET=' + require('crypto').randomBytes(32).toString('hex'))"

# NEXTAUTH_SECRET
node -e "console.log('NEXTAUTH_SECRET=' + require('crypto').randomBytes(32).toString('hex'))"
```

### æ­¥éª¤3ï¼šéƒ¨ç½²éªŒè¯
1. æ¨é€ä»£ç åç­‰å¾…Netlifyè‡ªåŠ¨éƒ¨ç½²
2. æ£€æŸ¥æ„å»ºæ—¥å¿—ä¸­çš„Prismaç”Ÿæˆæ˜¯å¦æˆåŠŸ
3. è®¿é—® `https://your-site.netlify.app/api/init/database` åˆå§‹åŒ–æ•°æ®åº“
4. è®¿é—®ä¸»é¡µæ£€æŸ¥åŠŸèƒ½æ˜¯å¦æ­£å¸¸

## ğŸ” æµ‹è¯•æ¸…å•

### APIç«¯ç‚¹æµ‹è¯•
- [ ] `GET /api/init/database` - æ•°æ®åº“åˆå§‹åŒ–
- [ ] `GET /api/reports` - è·å–æŠ¥å‘Šåˆ—è¡¨
- [ ] `POST /api/reports` - åˆ›å»ºæ–°æŠ¥å‘Š
- [ ] `GET /api/categories` - è·å–åˆ†ç±»åˆ—è¡¨

### åŠŸèƒ½æµ‹è¯•
- [ ] é¡µé¢æ­£å¸¸åŠ è½½ï¼ˆä¸»é¡µé‡å®šå‘åˆ°dashboardï¼‰
- [ ] ä¾§è¾¹æ åˆ†ç±»æ˜¾ç¤ºæ­£å¸¸
- [ ] åˆ›å»ºæŠ¥å‘ŠåŠŸèƒ½æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] æœç´¢è¿‡æ»¤åŠŸèƒ½æ­£å¸¸

### ç½‘ç»œæµ‹è¯•
```bash
# æµ‹è¯•APIå¯ç”¨æ€§
curl -X GET "https://your-site.netlify.app/api/init/database"
curl -X GET "https://your-site.netlify.app/api/reports"
curl -X GET "https://your-site.netlify.app/api/categories"
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### Context7æ¨èçš„ä¼˜åŒ–é…ç½®
1. **è¿æ¥æ± é™åˆ¶**ï¼š`connection_limit=1` é˜²æ­¢æ— æœåŠ¡å™¨ç¯å¢ƒè¿æ¥è€—å°½
2. **æ± è¶…æ—¶é…ç½®**ï¼š`pool_timeout=10` å¿«é€Ÿé‡Šæ”¾è¿æ¥
3. **å®ä¾‹å¤ç”¨**ï¼šå…¨å±€Prismaå®ä¾‹ç¼“å­˜å‡å°‘å†·å¯åŠ¨æ—¶é—´
4. **æ—¥å¿—ç®€åŒ–**ï¼šç”Ÿäº§ç¯å¢ƒæœ€å°åŒ–æ—¥å¿—è¾“å‡º

### ç›‘æ§æŒ‡æ ‡
- å‡½æ•°å†·å¯åŠ¨æ—¶é—´ï¼š< 2ç§’
- æ•°æ®åº“æŸ¥è¯¢å“åº”ï¼š< 500ms
- é¡µé¢é¦–å±åŠ è½½ï¼š< 3ç§’
- APIå“åº”æ—¶é—´ï¼š< 1ç§’

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
**ç—‡çŠ¶**ï¼šAPIè¿”å›500é”™è¯¯ï¼Œæ—¥å¿—æ˜¾ç¤ºPrismaè¿æ¥å¤±è´¥
**è§£å†³**ï¼š
- æ£€æŸ¥`DATABASE_URL`ç¯å¢ƒå˜é‡é…ç½®
- ç¡®è®¤è·¯å¾„ä½¿ç”¨`/tmp/dev.db`ï¼ˆNetlifyç¯å¢ƒï¼‰
- éªŒè¯è¿æ¥æ± å‚æ•°æ­£ç¡®è®¾ç½®

#### 2. å‡½æ•°è¶…æ—¶
**ç—‡çŠ¶**ï¼šAPIè¯·æ±‚è¶…è¿‡10ç§’æ— å“åº”
**è§£å†³**ï¼š
- æ£€æŸ¥PrismaæŸ¥è¯¢ä¼˜åŒ–
- å‡å°‘å•æ¬¡æŸ¥è¯¢çš„æ•°æ®é‡
- ä½¿ç”¨åˆ†é¡µå’Œç´¢å¼•ä¼˜åŒ–

#### 3. åˆå§‹åŒ–å¤±è´¥
**ç—‡çŠ¶**ï¼šé¦–æ¬¡è®¿é—®æ— æ³•åˆ›å»ºé»˜è®¤æ•°æ®
**è§£å†³**ï¼š
- æ‰‹åŠ¨è°ƒç”¨`/api/init/database`ç«¯ç‚¹
- æ£€æŸ¥ç”¨æˆ·IDé…ç½®æ˜¯å¦æ­£ç¡®
- éªŒè¯Prisma schemaä¸æ•°æ®åº“åŒæ­¥

#### 4. é‡å®šå‘å¾ªç¯
**ç—‡çŠ¶**ï¼šé¡µé¢æ— é™é‡å®šå‘
**è§£å†³**ï¼š
- æ£€æŸ¥`netlify.toml`é‡å®šå‘è§„åˆ™é¡ºåº
- ç¡®è®¤SPAå›é€€è§„åˆ™åœ¨æœ€å
- éªŒè¯Next.jsè·¯ç”±é…ç½®

## ğŸ“ å…³é”®å·®å¼‚

### ä¸ä¹‹å‰é…ç½®çš„ä¸»è¦å˜åŒ–
1. **æ„å»ºæµç¨‹**ï¼šç§»é™¤æ„å»ºæ—¶æ•°æ®åº“æ“ä½œï¼Œæ”¹ä¸ºè¿è¡Œæ—¶åˆå§‹åŒ–
2. **APIè·¯ç”±**ï¼šå…·ä½“åŒ–é‡å®šå‘è§„åˆ™ï¼Œæé«˜è·¯ç”±ç²¾ç¡®åº¦
3. **é”™è¯¯å¤„ç†**ï¼šè¯¦ç»†çš„é”™è¯¯åˆ†ç±»å’Œæ—¥å¿—è®°å½•
4. **å®ä¾‹ç®¡ç†**ï¼šæ— æœåŠ¡å™¨ç¯å¢ƒä¼˜åŒ–çš„Prismaå®ä¾‹å¤ç”¨

### Context7æœ€ä½³å®è·µè¦ç‚¹
1. **å»¶è¿Ÿåˆå§‹åŒ–**ï¼šåªåœ¨éœ€è¦æ—¶åˆ›å»ºæ•°æ®åº“è¿æ¥
2. **ä¼˜é›…é™çº§**ï¼šè‡ªåŠ¨æ£€æŸ¥å¹¶ä¿®å¤ç¼ºå¤±çš„æ•°æ®
3. **ç¯å¢ƒæ„ŸçŸ¥**ï¼šæ ¹æ®è¿è¡Œç¯å¢ƒè°ƒæ•´é…ç½®
4. **èµ„æºä¼˜åŒ–**ï¼šæœ€å°åŒ–æ— æœåŠ¡å™¨å‡½æ•°çš„èµ„æºä½¿ç”¨

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜ç­–ç•¥**ï¼šå®ç°APIå“åº”ç¼“å­˜
2. **å›¾ç‰‡ä¼˜åŒ–**ï¼šæ·»åŠ å›¾ç‰‡å‹ç¼©å’ŒCDN
3. **ç›‘æ§å‘Šè­¦**ï¼šé›†æˆé”™è¯¯ç›‘æ§æœåŠ¡
4. **æ€§èƒ½åˆ†æ**ï¼šæ·»åŠ æ€§èƒ½æŒ‡æ ‡æ”¶é›†
5. **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šCI/CDç®¡é“é›†æˆæµ‹è¯•

---

åŸºäºContext7çš„æœ€ä½³å®è·µï¼Œè¿™å¥—é…ç½®ä¸“é—¨é’ˆå¯¹Netlifyæ— æœåŠ¡å™¨ç¯å¢ƒè¿›è¡Œäº†ä¼˜åŒ–ï¼Œç¡®ä¿äº†ç¨³å®šæ€§ã€æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ã€‚ 